<!DOCTYPE html>
<html>

<meta charset="utf-8">

<link rel="stylesheet" href="css/style.css"></link>

<head>
    <title>Article Hunter</title>
</head>

<body>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script>
        var myurl = location.host;
        var socket = io.connect(myurl);
        console.log("in business");

        function sendFeeds() {
          socket.emit('feed', {feedParams: inputFeedsForm.feedsBox.value});
        }

        function sendKeywords() {
          socket.emit('keyword', {keywordParams: inputKeywordsForm.keywordsBox.value})
        }

        function begin() {
          document.getElementById("manualResultsScroll").innerHTML = "";
          socket.emit('begin');
        }

        // function clear() {
        //   socket.emit('clear');
        //   var feedList = document.getElementById("feedsScrollList");
        //   var keywordList = document.getElementById("keywordsScrollList");
        //
        //   while(feedList.hasChildNodes() || keywordList.hasChildNodes()) {
        //     feedList.removeChild(feedList.lastChild);
        //     keywordList.removeChild(keywordList.lastChild);
        //   }
        // }

        function appendKeywordsList() {
          xmlhttp = new XMLHttpRequest();
          xmlhttp.open("GET", window.location + "getkeywords", true);
          xmlhttp.onreadystatechange=function() {
            if (xmlhttp.readyState==4 && xmlhttp.status==200) {
              var ul = document.getElementById("keywordsScrollList");
              var li = document.createElement("li");
              li.appendChild(document.createTextNode(xmlhttp.responseText));
              ul.appendChild(li);
            }
          }
          xmlhttp.send();
        }

        function appendFeedsList() {
          xmlhttp = new XMLHttpRequest();
          xmlhttp.open("GET", window.location + "getfeeds", true);
          xmlhttp.onreadystatechange=function() {
            if (xmlhttp.readyState==4 && xmlhttp.status==200) {
              var ul = document.getElementById("feedsScrollList");
              var li = document.createElement("li");
              //console.log(xmlhttp.responseText);
              li.appendChild(document.createTextNode(xmlhttp.responseText));
              ul.appendChild(li);
            }
          }
          xmlhttp.send();
        }

        function removeFeedsElement() {
          var ul = document.getElementById("feedsScrollList");
          if(ul.hasChildNodes()) {
            ul.removeChild(ul.lastChild);
          }
        }

        function removeKeywordsElement() {
          var ul = document.getElementById("keywordsScrollList");
          if(ul.hasChildNodes()) {
            ul.removeChild(ul.lastChild);
          }
        }

        socket.on('autoArray', function(data) {
          // console.log("autoArray");
          // console.log(data['postTitle']);
          var nav = document.getElementById("autoResultsScroll");
          //label.appendChild(document.createTextNode(data));
          var a = document.createElement('a');

          var linkText = document.createTextNode(data['postTitle']);
          var linkAuthor = document.createTextNode(data['postAuthor'] + ": ");
          var br = document.createElement("br");
          a.appendChild(linkText);
          a.href = data['postLink'];

          nav.appendChild(linkAuthor);
          nav.appendChild(a);
          nav.appendChild(br);
        });


        socket.on("manualArray", function(data){
          console.log("manualArray");
          console.log(data);
          var nav = document.getElementById("manualResultsScroll");
          var a = document.createElement('a');

          var linkText = document.createTextNode(data['postTitle']);
          var br = document.createElement("br");
          a.appendChild(linkText);
          a.href = data['postLink'];

          nav.appendChild(a);
          nav.appendChild(br);
        });

        socket.on('formatAutoResults', function(data) {
          console.log("formatAutoResults: ");
          console.log(data);
          var text = document.createTextNode(data);
          var h2 = document.createElement('h2');
          var br = document.createElement("br");
          var nav = document.getElementById("autoResultsScroll");

          h2.appendChild(text);
          nav.appendChild(h2);
          nav.appendChild(br);
        });

        socket.on('formatManualResults', function(data) {
          console.log("formatManualResults: ");
          console.log(data);
          var text = document.createTextNode(data);
          var h2 = document.createElement('h2');
          var br = document.createElement("br");
          var nav = document.getElementById("manualResultsScroll");

          h2.appendChild(text);
          nav.appendChild(h2);
          nav.appendChild(br);
        });

        function removeKeyword() {
          socket.emit('removeKeyword');
        }

        function removeFeed() {
          socket.emit('removeFeed');
        }

    </script>

<div class="headerDiv">
    <span class="titleHeader">Article Hunter</span>
    <span class="gitHeader">
    <a href="https://github.com/JulienArnold/consum-rss-trawler">Go to Github</a>
    </span>
</div>

<div class="row" id="leftCol">

  <div id="inputFeedsDiv" class="col-1">
    <form id="inputFeedsForm" class="rssForm">
        <h1>Feeds</h1><br>
        <input type="text" id="feedsBox">
        <input type="button" id="feedsButton" value="Add" onclick="sendFeeds(); appendFeedsList();">
        <input type="button" id="feedsRemove" value="Remove" onclick="removeFeed(); removeFeedsElement();"><br><br><br>
        <div class="rssForm">
          <nav id="feedsScroll">
            <ul id="feedsScrollList">
            </ul>
          </nav>
        </div>
        <br>
    </form>
  </div>
</div>

<div class="row" id="rightCol">
  <div id="keywordFormDiv" class="col-1">
  <form id="inputKeywordsForm" class="rssForm">
    <h1>Additional Keywords</h1><br>
    <input type="text" id="keywordsBox">
    <input type="button" id="keywordsButton" value="Add" onclick="sendKeywords(); appendKeywordsList();">
    <input type="button" id="keywordsRemove" value="Remove" onclick="removeKeyword(); removeKeywordsElement();"><br><br><br>
    <div class="rssForm">
    <nav id="keywordsScroll">
      <ul id="keywordsScrollList">
      </ul>
    </nav>
  </div>
  <br>
  </form>

    <form>
      <input type="button" id="submitButton" value="Submit" onclick="begin()">
      <!-- <input type="button" id="clearButton" value="Clear" onclick="clear()"> -->
    </form>
  </div>


</div>

<div class="row">
  <div class="rssForm">
    <nav id="manualResultsScroll">
      <h1>Manual</h1>
    </nav>
  </div>

  <div class="rssForm">
    <nav id="autoResultsScroll">
      <h1>Automatic</h1>
    </nav>
  </div>
</div>

<!--
<div class="bottomRow">
  <div id="loggingDiv" class="col-1">
    <h2>Logging</h2>
    <nav id="consoleScroll">
      <label></label>
    </nav>
  </div>

  <div id="redirectDiv" class="col-2">
    <h2>Results (Manual)</h2>
    <a class="resultsLink" href="/results/manual">Manual Results Page</a>
  </div>

  <div id="redirectDiv2" class="col-3">
    <h2>Results (Auto)</h2>
    <a class="resultsLink" href="/results/auto">Automated Results</a>
  </div>
</div> -->

</body>

</html>
